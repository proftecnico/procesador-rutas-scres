<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scres¬© - Procesador de Rutas</title>
    <link rel="icon" href="logo.jpg" type="image/jpeg">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@12.0.0/dist/handsontable.full.min.css">
    
    <style>
        :root {
            --primary-color: #3b82f6; --primary-dark: #1d4ed8;
            --secondary-color: #475569; --success-color: #10b981;
            --warning-color: #f59e0b; --accent-orange: #ff6600;
            --bg-gradient-start: #f1f5f9; --bg-gradient-end: #e2e8f0;
            --header-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh; padding: 40px 20px; color: #334155;
        }

        .main-container {
            background: white; border-radius: 16px;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
            overflow: hidden; max-width: 1400px; margin: 0 auto;
        }

        /* Header */
        .header { background: var(--header-gradient); color: white; padding: 40px 30px; text-align: center; position: relative; }
        .header h1 { margin: 0; font-size: 2.2rem; font-weight: 700; }
        .brand-scres { font-family: 'Press Start 2P', cursive; font-size: 2rem; color: var(--accent-orange); text-shadow: 2px 2px 0px #000000; display: block; margin-bottom: 5px; }
        .brand-subtitle { font-size: 0.85rem; letter-spacing: 1px; color: #94a3b8; font-weight: 500; display: block; }
        .user-badge { position: absolute; top: 30px; right: 30px; background: rgba(255, 255, 255, 0.1); color: white; padding: 6px 16px; border-radius: 30px; font-size: 0.8rem; font-weight: 500; backdrop-filter: blur(5px); }

        /* Login */
        .login-container { max-width: 400px; margin: 80px auto; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.1); border: 1px solid #f1f5f9; }
        .btn-login { background: var(--primary-color); border: none; padding: 14px; font-weight: 600; border-radius: 8px; margin-top: 10px; color: white; width: 100%; }
        .btn-login:hover { background: var(--primary-dark); }

        /* Content */
        .content-wrapper { padding: 40px; }
        .nav-tabs .nav-link.active { color: var(--primary-color); background: #eff6ff; font-weight: 600; }
        .table-section { background: white; margin-top: 25px; }
        .table-container { border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        
        /* Botones */
        .btn-process { background-color: var(--success-color); border: none; padding: 12px 24px; color: white; font-weight: 600; border-radius: 8px; }
        .btn-save { background-color: var(--warning-color); border: none; color: white; border-radius: 8px; }

        /* Output Console */
        .output { background: #1e293b; color: #34d399; padding: 25px; border-radius: 12px; font-family: monospace; font-size: 0.85rem; line-height: 1.6; max-height: 300px; overflow-y: auto; margin-top: 20px; }

        /* Utilidades */
        .loading-overlay { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px); }
        .alert-custom { position: fixed; top: 20px; right: 20px; z-index: 10000; min-width: 300px; border-left: 4px solid currentColor; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .info-badge { background: #eff6ff; color: #2563eb; padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; font-weight: 500; border: 1px solid #dbeafe; }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="login-form">
            <div class="login-container">
                <div class="text-center mb-4">
                    <small class="text-muted text-uppercase fw-bold" style="letter-spacing: 2px;">Bienvenido a</small>
                    <div class="brand-scres mt-2">SCRES¬©</div>
                    <span class="brand-subtitle" style="color: var(--accent-orange);">By Jorge Garavagno</span>
                </div>
                <h2>Iniciar Sesi√≥n</h2>
                <form onsubmit="login(event)">
                    <div class="mb-3">
                        <label class="form-label">Usuario</label>
                        <input type="text" class="form-control" id="username" placeholder="Ej: Aesa" required>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Contrase√±a</label>
                        <input type="password" class="form-control" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="btn btn-login">Acceder al Sistema</button>
                </form>
            </div>
        </div>
        
        <div id="main-content" style="display: none;">
            <div class="header">
                <div class="brand-container">
                    <div class="brand-scres">SCRES¬©</div>
                    <span class="brand-subtitle">By Jorge Garavagno</span>
                </div>
                <h1>Procesador de Rutas Urbanas</h1>
                <div class="user-badge" id="userBadge"></div>
            </div>

            <div class="content-wrapper">
                <ul class="nav nav-tabs">
                    <li class="nav-item"><a class="nav-link active" href="#ptos" data-bs-toggle="tab">Tabla Ptos</a></li>
                    <li class="nav-item" id="admin-tab" style="display: none;"><a class="nav-link" href="#base" data-bs-toggle="tab">Base de Datos (Admin)</a></li>
                </ul>
                
                <div class="tab-content">
                    <div class="tab-pane active" id="ptos">
                        <div class="table-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h2>Tabla de Puntos</h2>
                                <div class="info-badge">üìã Pega los datos desde Excel</div>
                            </div>
                            
                            <div class="table-container" id="ptos-table"></div>
                            
                            <div class="mt-4">
                                <div class="mb-3">
                                    <button class="btn btn-process w-100" onclick="processData()">‚ö° 1. Procesar Datos</button>
                                </div>

                                <div class="card bg-light border-0 p-3">
                                    <h6 class="text-muted mb-3 text-uppercase fw-bold" style="font-size: 0.75rem;">Opciones de Env√≠o</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        
                                        <div class="bg-white p-3 rounded border flex-fill">
                                            <div class="d-flex align-items-center mb-2">
                                                <div id="serialStatusDot" style="width:10px; height:10px; border-radius:50%; background:#ef4444; margin-right:8px;"></div>
                                                <span id="serialStatusText" class="small fw-bold text-muted">USB Desconectado</span>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-secondary btn-sm" onclick="connectArduino()">üîå Conectar Arduino</button>
                                                <button class="btn btn-primary btn-sm" id="btnSendArduino" onclick="sendToArduino()" disabled>üì§ Enviar a Arduino</button>
                                            </div>
                                        </div>

                                        <div class="bg-white p-3 rounded border flex-fill">
                                            <div class="d-flex align-items-center mb-2">
                                                <span class="small fw-bold text-muted">ü§ñ Agente Local (.exe)</span>
                                                <span id="agentStatus" class="ms-auto small text-muted"></span>
                                            </div>
                                            <div class="d-grid">
                                                <button class="btn btn-dark btn-sm" id="btnSendAgent" onclick="sendToLocalAgent()" disabled>üì° Enviar v√≠a Script</button>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            
                            <div id="output" class="output"></div>
                        </div>
                    </div>
                    
                    <div class="tab-pane" id="base">
                        <div class="table-section">
                            <h2>Base de Datos de Unidades</h2>
                            <div class="alert alert-warning">‚ö†Ô∏è Solo administradores.</div>
                            <div class="table-container" id="base-table"></div>
                            <button class="btn btn-save mt-3" onclick="saveBase()">üíæ Guardar Cambios</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="routeModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="routeModalLabel">Configuraci√≥n de Ruta</h5>
                    </div>
                    <div class="modal-body">
                        <form id="routeForm">
                            <div class="mb-3"><label class="form-label">Unidad</label><input type="text" class="form-control" id="unidad" required></div>
                            <div class="row g-3">
                                <div class="col-6"><label class="form-label">Inicio Fecha</label><input type="date" class="form-control" id="fechaInicio" required></div>
                                <div class="col-6"><label class="form-label">Fin Fecha</label><input type="date" class="form-control" id="fechaFin" required></div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-6"><label class="form-label">Hora Inicio</label><input type="time" class="form-control" id="inicioHora" required></div>
                                <div class="col-6"><label class="form-label">Hora Fin</label><input type="time" class="form-control" id="finHora" required></div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="submitRoute">Confirmar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handsontable@12.0.0/dist/handsontable.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    
    <script>
       const _0x42462e=_0x10e1;(function(_0x2160d9,_0x2c6863){const _0x2157d1=_0x10e1,_0x5a8af1=_0x2160d9();while(!![]){try{const _0xb0ebf=-parseInt(_0x2157d1(0xe1))/0x1*(-parseInt(_0x2157d1(0x155))/0x2)+-parseInt(_0x2157d1(0xf3))/0x3+parseInt(_0x2157d1(0xca))/0x4*(-parseInt(_0x2157d1(0x13f))/0x5)+parseInt(_0x2157d1(0x10e))/0x6*(-parseInt(_0x2157d1(0x12f))/0x7)+-parseInt(_0x2157d1(0x136))/0x8+-parseInt(_0x2157d1(0xfc))/0x9+-parseInt(_0x2157d1(0xb5))/0xa*(-parseInt(_0x2157d1(0xf4))/0xb);if(_0xb0ebf===_0x2c6863)break;else _0x5a8af1['push'](_0x5a8af1['shift']());}catch(_0x23474e){_0x5a8af1['push'](_0x5a8af1['shift']());}}}(_0x46d8,0x8356a));const FECHA_VENCIMIENTO_WEB=new Date(_0x42462e(0x164));let role='',ptosHot,baseHot,processing=![],generatedData=[],port,writer,isArduinoConnected=![];function _0x46d8(){const _0x4c3511=['http://127.0.0.1:5000/status','body','‚úÖ\x20Procesado:\x20',',0000000','loadingOverlay','no-store','Direcci√≥n','username','btnSendArduino','add','fechaFin','addEventListener','2026-03-23','admin','#10b981','<div\x20class=\x22bg-white\x20p-4\x20rounded-3\x20text-center\x20shadow\x22><div\x20class=\x22spinner-border\x20text-primary\x20mb-3\x22></div><p\x20class=\x22mb-0\x20fw-bold\x22>','hours','Latitud','‚úÖ\x20Listo','application/json','display','danger','getDate','green','btnSendAgent','serial','div','10IIVPKw','admin-tab','value','toString','setDataAtCell','#N/A','‚è≥\x20Enviando...','indexOf','‚öôÔ∏è\x20Configurar\x20Ruta\x20','push','routeModal','No\x20se\x20generaron\x20datos.','\x20l√≠neas\x20enviadas.','write','login-form','baseData','ID\x20LENG','createElement','‚ùå\x20Error\x20conectando\x20Arduino:\x20','2929900000734261011,','userBadge','3625052FLQcTM','‚úÖ\x20Agente:\x20','\x20registros','info','find','pipeTo','click','Rutas','adminpass','üë§\x20Cliente\x20Aesa','Unidades','Sin\x20datos\x20para\x20procesar','getElementById','Unidad','innerHTML','üíæ\x20Guardado','Promedio','‚ùå\x20Error\x20Agente:\x20','.btn-login','message','Mobiliario\x20urbano','003438','block','288527NWuUuw','inicioHora','agentStatus','main-content','routeModalLabel','json','remove','Tag','headers','className','Pendientes','hide','‚ùå\x20Credenciales\x20incorrectas','now',';#IP1:000C;*07<','inicio','>RUS03,','trim','1542309DSvEDy','37269023XSyKwC','https://worldtimeapi.org/api/timezone/America/Argentina/Buenos_Aires','innerText','.btn-process','serialStatusText','floor','getData','getWriter','5562918ZeHwiN','http://127.0.0.1:5000/enviar','üîå\x20Arduino\x20conectado\x20correctamente','050384','‚ùå\x20No\x20se\x20encuentra\x20el\x20Agente\x20(.exe).\x20Ejec√∫talo\x20primero.','POST','show','length','finHora','querySelector','IMEI','zIndex','loading-overlay\x20position-fixed\x20top-0\x20start-0\x20w-100\x20h-100\x20d-flex\x20align-items-center\x20justify-content-center','replace','...</div>','random','all','preventDefault','90918rQyIwn','fin','toISOString','#ef4444','getItem','unidad','<div\x20style=\x22color:#3b82f6;\x20font-size:0.8em\x22>üîå\x20USB:\x20Enviando\x20','Punto\x20de\x20recolecci√≥n','No\x20se\x20encontraron\x20rutas\x20en\x20la\x20columna\x20\x22Rutas\x22','padEnd','Completa\x20todos\x20los\x20campos','output','non-commercial-and-evaluation','minutes','requestPort','‚úÖ\x20Env√≠o\x20a\x20Arduino\x20completado','error','removeEventListener','Conecta\x20el\x20Arduino\x20primero','Verificando\x20fecha...','</p></div>','success','stringify','Salvadores','scrollHeight','HEAD','slice','routeForm','üî¥\x20Error','color','red','format','readable','420QlNGEH','textContent','style','Desconectado','map','writable','Fin','6144512LypleN','open','DDMMYYHHmmss','Inicio','setItem','diff','submitRoute','warning','\x20alert-custom\x20shadow-sm','5YSrigA','003519','reset','disabled','serialStatusDot','Error:','clone','appendChild','üü¢\x20Enviando...','href','location','scrollTop','9999','Enviando...','DOMContentLoaded','abs','Modal','split','Procesando...','IMEI\x20LENG','base-table','fechaInicio','6QfPRun','date','parse'];_0x46d8=function(){return _0x4c3511;};return _0x46d8();}const baseData=[[_0x42462e(0xd4),_0x42462e(0x106),'ID',_0x42462e(0x152),_0x42462e(0xc5),'','',''],[0x3f8,0x310f561214fda,'003535',0xf,0x6,'','',''],[0x3f9,0x310f56121cd68,_0x42462e(0xdf),0xf,0x6,'','',''],[0x3fa,0x310f56132c02a,_0x42462e(0x140),0xf,0x6,'',-0x13b119657b556,-0x212c6df629597],[0x3fb,0x310f56132c520,'003332',0xf,0x6,'','',''],[0x40d,0x3121fa481d502,_0x42462e(0xff),0xf,0x6,'','','']];!localStorage[_0x42462e(0x112)](_0x42462e(0xc4))&&localStorage[_0x42462e(0x13a)]('baseData',JSON[_0x42462e(0x124)](baseData));async function connectArduino(){const _0xc33f84=_0x42462e;if(_0xc33f84(0xb3)in navigator)try{port=await navigator[_0xc33f84(0xb3)][_0xc33f84(0x11c)](),await port[_0xc33f84(0x137)]({'baudRate':0x2580});const _0xd56472=new TextEncoderStream(),_0x1ae48e=_0xd56472[_0xc33f84(0x12e)][_0xc33f84(0xcf)](port[_0xc33f84(0x134)]);writer=_0xd56472[_0xc33f84(0x134)][_0xc33f84(0xfb)](),isArduinoConnected=!![],updateArduinoUI(!![]),showAlert(_0xc33f84(0xfe),'success');}catch(_0x30009d){console[_0xc33f84(0x11e)](_0xc33f84(0x144),_0x30009d),showAlert(_0xc33f84(0xc7)+_0x30009d[_0xc33f84(0xdd)],_0xc33f84(0xaf));}else showAlert('‚ö†Ô∏è\x20Navegador\x20no\x20compatible\x20con\x20USB\x20Serial.\x20Use\x20Chrome.','warning');}function updateArduinoUI(_0x16c0c6){const _0x28cbf1=_0x42462e,_0x3fae7f=document[_0x28cbf1(0xd6)](_0x28cbf1(0x143)),_0x31599c=document[_0x28cbf1(0xd6)](_0x28cbf1(0xf8)),_0x50f3a7=document[_0x28cbf1(0xd6)](_0x28cbf1(0x160));if(_0x16c0c6){_0x3fae7f[_0x28cbf1(0x131)]['background']=_0x28cbf1(0x166),_0x31599c[_0x28cbf1(0x130)]='Conectado',_0x31599c[_0x28cbf1(0x131)]['color']=_0x28cbf1(0x166);if(generatedData['length']>0x0)_0x50f3a7[_0x28cbf1(0x142)]=![];}else _0x3fae7f[_0x28cbf1(0x131)]['background']=_0x28cbf1(0x111),_0x31599c[_0x28cbf1(0x130)]=_0x28cbf1(0x132),_0x50f3a7[_0x28cbf1(0x142)]=!![];}async function sendToArduino(){const _0x553282=_0x42462e;if(!isArduinoConnected||!writer)return showAlert(_0x553282(0x120),_0x553282(0x13d));const _0x28d618=document[_0x553282(0xd6)](_0x553282(0x160));_0x28d618[_0x553282(0x142)]=!![],_0x28d618[_0x553282(0xd8)]=_0x553282(0x14c);try{for(let _0x2800ec=0x0;_0x2800ec<generatedData[_0x553282(0x103)];_0x2800ec++){const _0x55db9d=generatedData[_0x2800ec];if(_0x55db9d[_0x553282(0xf2)]()){await writer[_0x553282(0xc2)](_0x55db9d+'\x0a'),document['getElementById'](_0x553282(0x119))[_0x553282(0xd8)]+=_0x553282(0x114)+(_0x2800ec+0x1)+'/'+generatedData['length']+_0x553282(0x10a);const _0x536f31=document[_0x553282(0xd6)]('output');_0x536f31[_0x553282(0x14a)]=_0x536f31[_0x553282(0x126)],await new Promise(_0x43dc0a=>setTimeout(_0x43dc0a,0x3e8));}}showAlert(_0x553282(0x11d),'success');}catch(_0x5a6e49){showAlert('‚ùå\x20Error\x20USB:\x20'+_0x5a6e49[_0x553282(0xdd)],_0x553282(0xaf));}finally{_0x28d618[_0x553282(0x142)]=![],_0x28d618[_0x553282(0xd8)]='üì§\x20Enviar\x20a\x20Arduino';}}async function sendToLocalAgent(){const _0x45d8f2=_0x42462e;if(generatedData[_0x45d8f2(0x103)]===0x0)return showAlert('No\x20hay\x20datos\x20para\x20enviar',_0x45d8f2(0x13d));const _0x2b273b=document[_0x45d8f2(0xd6)](_0x45d8f2(0xb2)),_0x3b57ee=document['getElementById'](_0x45d8f2(0xe3));_0x3b57ee[_0x45d8f2(0x130)]='üîç\x20Buscando\x20.exe...';try{await fetch(_0x45d8f2(0x158));}catch(_0xb6568c){showAlert(_0x45d8f2(0x100),_0x45d8f2(0xaf)),_0x3b57ee[_0x45d8f2(0x130)]='üî¥\x20Desconectado';return;}_0x2b273b[_0x45d8f2(0x142)]=!![],_0x2b273b[_0x45d8f2(0xd8)]=_0x45d8f2(0xbb),_0x3b57ee[_0x45d8f2(0x130)]=_0x45d8f2(0x147),_0x3b57ee[_0x45d8f2(0x131)][_0x45d8f2(0x12b)]=_0x45d8f2(0xb1);try{const _0x2fc31e=await fetch(_0x45d8f2(0xfd),{'method':_0x45d8f2(0x101),'headers':{'Content-Type':_0x45d8f2(0xad)},'body':JSON['stringify']({'lines':generatedData})}),_0x38cd91=await _0x2fc31e[_0x45d8f2(0xe6)]();if(_0x2fc31e['ok'])showAlert(_0x45d8f2(0xcb)+_0x38cd91['processed']+_0x45d8f2(0xc1),_0x45d8f2(0x123)),_0x3b57ee[_0x45d8f2(0x130)]=_0x45d8f2(0xac);else throw new Error(_0x38cd91[_0x45d8f2(0x11e)]);}catch(_0x2482e8){showAlert(_0x45d8f2(0xdb)+_0x2482e8[_0x45d8f2(0xdd)],'danger'),_0x3b57ee[_0x45d8f2(0x130)]=_0x45d8f2(0x12a),_0x3b57ee['style']['color']=_0x45d8f2(0x12c);}finally{_0x2b273b[_0x45d8f2(0x142)]=![],_0x2b273b[_0x45d8f2(0xd8)]='üì°\x20Enviar\x20v√≠a\x20Script';}}async function obtenerFechaInternet(){const _0x3244e0=_0x42462e;try{const _0x39b0d2=await fetch(window[_0x3244e0(0x149)][_0x3244e0(0x148)],{'method':_0x3244e0(0x127),'cache':_0x3244e0(0x15d)}),_0x1f7d16=_0x39b0d2[_0x3244e0(0xe9)]['get'](_0x3244e0(0x156));if(!_0x1f7d16){const _0x2c7465=await fetch(_0x3244e0(0xf5));return new Date((await _0x2c7465[_0x3244e0(0xe6)]())['datetime']);}return new Date(_0x1f7d16);}catch(_0x3d6f66){return null;}}function _0x10e1(_0xdca004,_0x37aae6){const _0x46d80b=_0x46d8();return _0x10e1=function(_0x10e120,_0xa5fa93){_0x10e120=_0x10e120-0xa9;let _0x183c23=_0x46d80b[_0x10e120];return _0x183c23;},_0x10e1(_0xdca004,_0x37aae6);}async function login(_0x2bc075){const _0xff9616=_0x42462e;_0x2bc075[_0xff9616(0x10d)]();const _0x1eefed=document[_0xff9616(0x105)](_0xff9616(0xdc)),_0x535b7a=_0x1eefed[_0xff9616(0xd8)];_0x1eefed[_0xff9616(0x142)]=!![],_0x1eefed[_0xff9616(0xd8)]=_0xff9616(0x121);const _0x148310=document[_0xff9616(0xd6)](_0xff9616(0x15f))[_0xff9616(0xb7)][_0xff9616(0xf2)](),_0x1b0d49=document[_0xff9616(0xd6)]('password')['value'],_0x1c15fc=await obtenerFechaInternet();if(!_0x1c15fc){showAlert('‚ö†Ô∏è\x20Sin\x20internet:\x20No\x20se\x20puede\x20validar\x20licencia.',_0xff9616(0x13d)),_0x1eefed[_0xff9616(0x142)]=![],_0x1eefed[_0xff9616(0xd8)]=_0x535b7a;return;}if(_0x148310==='admin'&&_0x1b0d49===_0xff9616(0xd2))role='admin',startApp('üë§\x20Admin');else{if(_0x148310==='Aesa'&&_0x1b0d49===_0xff9616(0x125)){if(_0x1c15fc>FECHA_VENCIMIENTO_WEB){showAlert('‚õî\x20LICENCIA\x20VENCIDA\x20(Verificaci√≥n\x20Online).',_0xff9616(0xaf)),_0x1eefed[_0xff9616(0x142)]=![],_0x1eefed[_0xff9616(0xd8)]=_0x535b7a;return;}role='normal',startApp(_0xff9616(0xd3));}else showAlert(_0xff9616(0xed),_0xff9616(0xaf)),_0x1eefed['disabled']=![],_0x1eefed['innerHTML']=_0x535b7a;}}function startApp(_0x50f947){const _0x5b9cc6=_0x42462e;document[_0x5b9cc6(0xd6)](_0x5b9cc6(0xc3))[_0x5b9cc6(0x131)][_0x5b9cc6(0xae)]='none',document['getElementById'](_0x5b9cc6(0xe4))['style'][_0x5b9cc6(0xae)]=_0x5b9cc6(0xe0),document[_0x5b9cc6(0xd6)](_0x5b9cc6(0xc9))[_0x5b9cc6(0xd8)]=_0x50f947;if(role==='admin')document['getElementById'](_0x5b9cc6(0xb6))['style'][_0x5b9cc6(0xae)]='block';initTables();}async function processData(){const _0x33cda0=_0x42462e;if(processing)return;processing=!![],document[_0x33cda0(0x105)](_0x33cda0(0xf7))['disabled']=!![],showLoading(_0x33cda0(0x151)),generatedData=[];try{const _0x47f92e=ptosHot[_0x33cda0(0xfa)](),_0x5cca9e=_0x47f92e[_0x33cda0(0x128)](0x1)['filter'](_0x1cfb3c=>_0x1cfb3c[0x0]&&_0x1cfb3c[0x0][_0x33cda0(0xb8)]()['trim']()!=='');if(_0x5cca9e[_0x33cda0(0x103)]===0x0)throw new Error(_0x33cda0(0xd5));const _0x48b6b4=new Set();_0x5cca9e['forEach'](_0x3d3414=>{const _0x2151b0=_0x33cda0;if(_0x3d3414[0x5])_0x3d3414[0x5][_0x2151b0(0xb8)]()[_0x2151b0(0x150)](',')['forEach'](_0x1394b8=>{const _0x43d312=_0x2151b0;if(_0x1394b8['trim']())_0x48b6b4[_0x43d312(0x161)](_0x1394b8[_0x43d312(0xf2)]());});});const _0x289168=[..._0x48b6b4];if(_0x289168[_0x33cda0(0x103)]===0x0)throw new Error(_0x33cda0(0x116));const _0x315b98={},_0x5311c7=document['getElementById'](_0x33cda0(0xbf)),_0xc72a94=new bootstrap[(_0x33cda0(0x14f))](_0x5311c7);hideLoading();for(const _0x36460e of _0x289168){document[_0x33cda0(0xd6)](_0x33cda0(0xe5))[_0x33cda0(0xf6)]=_0x33cda0(0xbd)+_0x36460e;const _0xdf85dd=document[_0x33cda0(0xd6)](_0x33cda0(0x129));_0xdf85dd[_0x33cda0(0x141)](),document['getElementById']('fechaInicio')[_0x33cda0(0xb7)]=new Date(Date[_0x33cda0(0xee)]()-0x5265c00)[_0x33cda0(0x110)]()[_0x33cda0(0x150)]('T')[0x0],document[_0x33cda0(0xd6)](_0x33cda0(0x162))[_0x33cda0(0xb7)]=new Date()[_0x33cda0(0x110)]()[_0x33cda0(0x150)]('T')[0x0];const _0x148656=await new Promise(_0x232af1=>{const _0x411b58=_0x33cda0,_0x333dd0=()=>{const _0x396d7e=_0x10e1,_0x2fcf0a=document[_0x396d7e(0xd6)]('unidad')[_0x396d7e(0xb7)],_0x1fd0bd=document[_0x396d7e(0xd6)](_0x396d7e(0x154))[_0x396d7e(0xb7)],_0x33fad5=document[_0x396d7e(0xd6)]('fechaFin')[_0x396d7e(0xb7)],_0x481760=document[_0x396d7e(0xd6)](_0x396d7e(0xe2))[_0x396d7e(0xb7)],_0x22e0b9=document[_0x396d7e(0xd6)](_0x396d7e(0x104))[_0x396d7e(0xb7)];if(_0x2fcf0a&&_0x1fd0bd&&_0x33fad5&&_0x481760&&_0x22e0b9)_0xc72a94[_0x396d7e(0xec)](),document['getElementById']('submitRoute')[_0x396d7e(0x11f)](_0x396d7e(0xd0),_0x333dd0),_0x232af1({'unidad':_0x2fcf0a,'inicio':_0x1fd0bd+'\x20'+_0x481760,'fin':_0x33fad5+'\x20'+_0x22e0b9});else alert(_0x396d7e(0x118));};document[_0x411b58(0xd6)](_0x411b58(0x13c))['addEventListener'](_0x411b58(0xd0),_0x333dd0),_0xc72a94[_0x411b58(0x102)]();});_0x315b98[_0x36460e]=_0x148656;}showLoading('Generando...');let _0x84d58='';_0x5cca9e['forEach']((_0x1607c7,_0x2c906f)=>{const _0x1889fd=_0x33cda0,_0x2e5f12=_0x47f92e[_0x1889fd(0xbc)](_0x1607c7),_0x2338e1=_0x1607c7[0x5]?_0x1607c7[0x5]['toString']()[_0x1889fd(0x150)](',')[_0x1889fd(0x133)](_0x48a7ba=>_0x48a7ba['trim']()):[];let _0x322750=null;for(const _0x42266c of _0x2338e1)if(_0x315b98[_0x42266c]){_0x322750=_0x315b98[_0x42266c];break;}if(!_0x322750||!_0x1607c7[0xc]||!_0x1607c7[0xd])return;ptosHot[_0x1889fd(0xb9)](_0x2e5f12,0xe,_0x322750[_0x1889fd(0x113)]),ptosHot[_0x1889fd(0xb9)](_0x2e5f12,0xf,_0x322750[_0x1889fd(0xf0)]),ptosHot['setDataAtCell'](_0x2e5f12,0x10,_0x322750['fin']);const _0x13f4e0=parseFloat(_0x1607c7[0xc]),_0x5fae55=parseFloat(_0x1607c7[0xd]),_0x4a4d02=(_0x13f4e0<0x0?'-':'')+Math[_0x1889fd(0x14e)](_0x13f4e0)['toString']()['replace']('.','')[_0x1889fd(0x117)](0xf,'0')['slice'](0x0,0x7),_0xc2108b=(_0x5fae55<0x0?'-':'')+Math['abs'](_0x5fae55)[_0x1889fd(0xb8)]()[_0x1889fd(0x109)]('.','')[_0x1889fd(0x117)](0xf,'0')['slice'](0x0,0x6);ptosHot[_0x1889fd(0xb9)](_0x2e5f12,0xc,_0x4a4d02),ptosHot[_0x1889fd(0xb9)](_0x2e5f12,0xd,_0xc2108b);const _0x3c5780=moment(_0x322750[_0x1889fd(0xf0)]),_0x4faaf0=moment(_0x322750[_0x1889fd(0x10f)]),_0x36a12a=Math[_0x1889fd(0xf9)](Math[_0x1889fd(0x10b)]()*_0x4faaf0[_0x1889fd(0x13b)](_0x3c5780,_0x1889fd(0x11b))),_0xd8dfc0=_0x3c5780[_0x1889fd(0x145)]()[_0x1889fd(0x161)](_0x36a12a,_0x1889fd(0x11b))[_0x1889fd(0x161)](0x3,_0x1889fd(0xaa)),_0xbc5679=JSON[_0x1889fd(0x157)](localStorage[_0x1889fd(0x112)](_0x1889fd(0xc4))),_0x3626c9=_0xbc5679[_0x1889fd(0xce)](_0x6d2b35=>_0x6d2b35[0x0]==_0x322750[_0x1889fd(0x113)]),_0x3c4249=_0x3626c9?_0x3626c9[0x1]:'#N/A',_0x264b89=_0x3626c9?_0x3626c9[0x2]:_0x1889fd(0xba),_0x2c0eb5=_0x1889fd(0xf1)+_0xd8dfc0[_0x1889fd(0x12d)](_0x1889fd(0x138))+_0x4a4d02+_0xc2108b+_0x1889fd(0xc8)+_0x3c4249+_0x1889fd(0x15b)+(_0x1607c7[0x4]||'0')+',001;ID='+_0x264b89+_0x1889fd(0xef);generatedData[_0x1889fd(0xbe)](_0x2c0eb5),_0x84d58+=_0x2c0eb5+'\x0a';}),ptosHot['render'](),document['getElementById'](_0x33cda0(0x119))[_0x33cda0(0xf6)]=_0x84d58||_0x33cda0(0xc0);if(generatedData['length']>0x0){document['getElementById'](_0x33cda0(0xb2))['disabled']=![];if(isArduinoConnected)document[_0x33cda0(0xd6)](_0x33cda0(0x160))[_0x33cda0(0x142)]=![];}showAlert(_0x33cda0(0x15a)+generatedData[_0x33cda0(0x103)]+_0x33cda0(0xcc),_0x33cda0(0x123));}catch(_0x1baab4){showAlert('‚ùå\x20'+_0x1baab4['message'],'danger');}finally{processing=![],document[_0x33cda0(0x105)]('.btn-process')[_0x33cda0(0x142)]=![],hideLoading();}}function initTables(){const _0x12b87b=_0x42462e;ptosHot=new Handsontable(document[_0x12b87b(0xd6)]('ptos-table'),{'data':[[_0x12b87b(0x15e),_0x12b87b(0x115),_0x12b87b(0xde),'Tipo',_0x12b87b(0xe8),_0x12b87b(0xd1),'Total',_0x12b87b(0xeb),_0x12b87b(0xda),'Servicios','No\x20Op','Cumplimiento',_0x12b87b(0xab),'Longitud',_0x12b87b(0xd7),_0x12b87b(0x139),_0x12b87b(0x135)]],'rowHeaders':!![],'colHeaders':!![],'height':0x258,'licenseKey':_0x12b87b(0x11a),'minRows':0x32,'minCols':0x11,'contextMenu':!![],'manualColumnResize':!![],'stretchH':'all'});if(role===_0x12b87b(0x165)){const _0x11b9f6=JSON[_0x12b87b(0x157)](localStorage[_0x12b87b(0x112)](_0x12b87b(0xc4)));baseHot=new Handsontable(document[_0x12b87b(0xd6)](_0x12b87b(0x153)),{'data':_0x11b9f6||baseData,'rowHeaders':!![],'colHeaders':!![],'height':0x258,'licenseKey':_0x12b87b(0x11a),'minRows':0x32,'minCols':0x9,'contextMenu':!![],'manualColumnResize':!![],'stretchH':_0x12b87b(0x10c)});}}function saveBase(){const _0x20eba9=_0x42462e;if(role!=='admin')return;localStorage[_0x20eba9(0x13a)](_0x20eba9(0xc4),JSON[_0x20eba9(0x124)](baseHot[_0x20eba9(0xfa)]())),showAlert(_0x20eba9(0xd9),_0x20eba9(0x123));}function showAlert(_0x2d7f3a,_0x2f38a6=_0x42462e(0xcd)){const _0x17df57=_0x42462e,_0x3cebf7=document[_0x17df57(0xc6)](_0x17df57(0xb4));_0x3cebf7[_0x17df57(0xea)]='alert\x20alert-'+_0x2f38a6+_0x17df57(0x13e),_0x3cebf7[_0x17df57(0xd8)]=_0x2d7f3a,document[_0x17df57(0x159)][_0x17df57(0x146)](_0x3cebf7),setTimeout(()=>_0x3cebf7[_0x17df57(0xe7)](),0xfa0);}function showLoading(_0x43af69){const _0xdf9ec4=_0x42462e,_0x1228fc=document[_0xdf9ec4(0xc6)](_0xdf9ec4(0xb4));_0x1228fc[_0xdf9ec4(0xea)]=_0xdf9ec4(0x108),_0x1228fc['id']=_0xdf9ec4(0x15c),_0x1228fc[_0xdf9ec4(0x131)][_0xdf9ec4(0x107)]=_0xdf9ec4(0x14b),_0x1228fc[_0xdf9ec4(0xd8)]=_0xdf9ec4(0xa9)+_0x43af69+_0xdf9ec4(0x122),document[_0xdf9ec4(0x159)][_0xdf9ec4(0x146)](_0x1228fc);}function hideLoading(){const _0x55dcc5=_0x42462e,_0x4bd1df=document[_0x55dcc5(0xd6)](_0x55dcc5(0x15c));if(_0x4bd1df)_0x4bd1df[_0x55dcc5(0xe7)]();}document[_0x42462e(0x163)](_0x42462e(0x14d),()=>{const _0xb37195=_0x42462e,_0x5da27b=new Date(),_0x4a34cc=new Date(_0x5da27b);_0x4a34cc['setDate'](_0x4a34cc[_0xb37195(0xb0)]()-0x1);const _0x517b93=document[_0xb37195(0xd6)](_0xb37195(0x154)),_0x184f5e=document[_0xb37195(0xd6)](_0xb37195(0x162));_0x517b93&&_0x184f5e&&(_0x517b93['value']=_0x4a34cc[_0xb37195(0x110)]()['split']('T')[0x0],_0x184f5e[_0xb37195(0xb7)]=_0x5da27b[_0xb37195(0x110)]()['split']('T')[0x0]);});
    </script>
</body>

</html>




