<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scres¬© - Procesador de Rutas</title>
    <link rel="icon" href="logo.jpg" type="image/jpeg">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/handsontable@12.0.0/dist/handsontable.full.min.css">
    
    <style>
        :root {
            --primary-color: #3b82f6; --primary-dark: #1d4ed8;
            --secondary-color: #475569; --success-color: #10b981;
            --warning-color: #f59e0b; --accent-orange: #ff6600;
            --bg-gradient-start: #f1f5f9; --bg-gradient-end: #e2e8f0;
            --header-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh; padding: 40px 20px; color: #334155;
        }

        .main-container {
            background: white; border-radius: 16px;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.1);
            overflow: hidden; max-width: 1400px; margin: 0 auto;
        }

        /* Header */
        .header { background: var(--header-gradient); color: white; padding: 40px 30px; text-align: center; position: relative; }
        .header h1 { margin: 0; font-size: 2.2rem; font-weight: 700; }
        .brand-scres { font-family: 'Press Start 2P', cursive; font-size: 2rem; color: var(--accent-orange); text-shadow: 2px 2px 0px #000000; display: block; margin-bottom: 5px; }
        .brand-subtitle { font-size: 0.85rem; letter-spacing: 1px; color: #94a3b8; font-weight: 500; display: block; }
        .user-badge { position: absolute; top: 30px; right: 30px; background: rgba(255, 255, 255, 0.1); color: white; padding: 6px 16px; border-radius: 30px; font-size: 0.8rem; font-weight: 500; backdrop-filter: blur(5px); }

        /* Login */
        .login-container { max-width: 400px; margin: 80px auto; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.1); border: 1px solid #f1f5f9; }
        .btn-login { background: var(--primary-color); border: none; padding: 14px; font-weight: 600; border-radius: 8px; margin-top: 10px; color: white; width: 100%; }
        .btn-login:hover { background: var(--primary-dark); }

        /* Content */
        .content-wrapper { padding: 40px; }
        .nav-tabs .nav-link.active { color: var(--primary-color); background: #eff6ff; font-weight: 600; }
        .table-section { background: white; margin-top: 25px; }
        .table-container { border: 1px solid #e2e8f0; border-radius: 8px; overflow: hidden; }
        
        /* Botones */
        .btn-process { background-color: var(--success-color); border: none; padding: 12px 24px; color: white; font-weight: 600; border-radius: 8px; }
        .btn-save { background-color: var(--warning-color); border: none; color: white; border-radius: 8px; }

        /* Output Console */
        .output { background: #1e293b; color: #34d399; padding: 25px; border-radius: 12px; font-family: monospace; font-size: 0.85rem; line-height: 1.6; max-height: 300px; overflow-y: auto; margin-top: 20px; }

        /* Utilidades */
        .loading-overlay { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px); }
        .alert-custom { position: fixed; top: 20px; right: 20px; z-index: 10000; min-width: 300px; border-left: 4px solid currentColor; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .info-badge { background: #eff6ff; color: #2563eb; padding: 8px 16px; border-radius: 6px; font-size: 0.85rem; font-weight: 500; border: 1px solid #dbeafe; }
    </style>
</head>
<body>
    <div class="main-container">
        <div id="login-form">
            <div class="login-container">
                <div class="text-center mb-4">
                    <small class="text-muted text-uppercase fw-bold" style="letter-spacing: 2px;">Bienvenido a</small>
                    <div class="brand-scres mt-2">SCRES¬©</div>
                    <span class="brand-subtitle" style="color: var(--accent-orange);">By Jorge Garavagno</span>
                </div>
                <h2>Iniciar Sesi√≥n</h2>
                <form onsubmit="login(event)">
                    <div class="mb-3">
                        <label class="form-label">Usuario</label>
                        <input type="text" class="form-control" id="username" placeholder="Ej: Aesa" required>
                    </div>
                    <div class="mb-4">
                        <label class="form-label">Contrase√±a</label>
                        <input type="password" class="form-control" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" class="btn btn-login">Acceder al Sistema</button>
                </form>
            </div>
        </div>
        
        <div id="main-content" style="display: none;">
            <div class="header">
                <div class="brand-container">
                    <div class="brand-scres">SCRES¬©</div>
                    <span class="brand-subtitle">By Jorge Garavagno</span>
                </div>
                <h1>Procesador de Rutas Urbanas</h1>
                <div class="user-badge" id="userBadge"></div>
            </div>

            <div class="content-wrapper">
                <ul class="nav nav-tabs">
                    <li class="nav-item"><a class="nav-link active" href="#ptos" data-bs-toggle="tab">Tabla Ptos</a></li>
                    <li class="nav-item" id="admin-tab" style="display: none;"><a class="nav-link" href="#base" data-bs-toggle="tab">Base de Datos (Admin)</a></li>
                </ul>
                
                <div class="tab-content">
                    <div class="tab-pane active" id="ptos">
                        <div class="table-section">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h2>Tabla de Puntos</h2>
                                <div class="info-badge">üìã Pega los datos desde Excel</div>
                            </div>
                            
                            <div class="table-container" id="ptos-table"></div>
                            
                            <div class="mt-4">
                                <div class="mb-3">
                                    <button class="btn btn-process w-100" onclick="processData()">‚ö° 1. Procesar Datos</button>
                                </div>

                                <div class="card bg-light border-0 p-3">
                                    <h6 class="text-muted mb-3 text-uppercase fw-bold" style="font-size: 0.75rem;">Opciones de Env√≠o</h6>
                                    <div class="d-flex flex-wrap gap-3">
                                        
                                        <div class="bg-white p-3 rounded border flex-fill">
                                            <div class="d-flex align-items-center mb-2">
                                                <div id="serialStatusDot" style="width:10px; height:10px; border-radius:50%; background:#ef4444; margin-right:8px;"></div>
                                                <span id="serialStatusText" class="small fw-bold text-muted">USB Desconectado</span>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-secondary btn-sm" onclick="connectArduino()">üîå Conectar Arduino</button>
                                                <button class="btn btn-primary btn-sm" id="btnSendArduino" onclick="sendToArduino()" disabled>üì§ Enviar a Arduino</button>
                                            </div>
                                        </div>

                                        <div class="bg-white p-3 rounded border flex-fill">
                                            <div class="d-flex align-items-center mb-2">
                                                <span class="small fw-bold text-muted">ü§ñ Agente Local (.exe)</span>
                                                <span id="agentStatus" class="ms-auto small text-muted"></span>
                                            </div>
                                            <div class="d-grid">
                                                <button class="btn btn-dark btn-sm" id="btnSendAgent" onclick="sendToLocalAgent()" disabled>üì° Enviar v√≠a Script</button>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            
                            <div id="output" class="output"></div>
                        </div>
                    </div>
                    
                    <div class="tab-pane" id="base">
                        <div class="table-section">
                            <h2>Base de Datos de Unidades</h2>
                            <div class="alert alert-warning">‚ö†Ô∏è Solo administradores.</div>
                            <div class="table-container" id="base-table"></div>
                            <button class="btn btn-save mt-3" onclick="saveBase()">üíæ Guardar Cambios</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="routeModal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="routeModalLabel">Configuraci√≥n de Ruta</h5>
                    </div>
                    <div class="modal-body">
                        <form id="routeForm">
                            <div class="mb-3"><label class="form-label">Unidad</label><input type="text" class="form-control" id="unidad" required></div>
                            <div class="row g-3">
                                <div class="col-6"><label class="form-label">Inicio Fecha</label><input type="date" class="form-control" id="fechaInicio" required></div>
                                <div class="col-6"><label class="form-label">Fin Fecha</label><input type="date" class="form-control" id="fechaFin" required></div>
                            </div>
                            <div class="row g-3 mt-2">
                                <div class="col-6"><label class="form-label">Hora Inicio</label><input type="time" class="form-control" id="inicioHora" required></div>
                                <div class="col-6"><label class="form-label">Hora Fin</label><input type="time" class="form-control" id="finHora" required></div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" id="submitRoute">Confirmar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handsontable@12.0.0/dist/handsontable.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
    
    <script>
       const _0x3c5b6b=_0x3860;(function(_0x4b2775,_0x35c434){const _0x16bb3a=_0x3860,_0x2fafe6=_0x4b2775();while(!![]){try{const _0x4616eb=-parseInt(_0x16bb3a(0xa4))/0x1+-parseInt(_0x16bb3a(0x10d))/0x2+-parseInt(_0x16bb3a(0x7e))/0x3+parseInt(_0x16bb3a(0x13a))/0x4+parseInt(_0x16bb3a(0x88))/0x5*(-parseInt(_0x16bb3a(0x9b))/0x6)+-parseInt(_0x16bb3a(0x103))/0x7+-parseInt(_0x16bb3a(0x130))/0x8*(-parseInt(_0x16bb3a(0xf2))/0x9);if(_0x4616eb===_0x35c434)break;else _0x2fafe6['push'](_0x2fafe6['shift']());}catch(_0xb23b28){_0x2fafe6['push'](_0x2fafe6['shift']());}}}(_0x12e6,0x9772f));function _0x3860(_0x54e128,_0x1c106e){const _0x12e661=_0x12e6();return _0x3860=function(_0x386009,_0x5ac065){_0x386009=_0x386009-0x7b;let _0x5134f6=_0x12e661[_0x386009];return _0x5134f6;},_0x3860(_0x54e128,_0x1c106e);}const FECHA_VENCIMIENTO_WEB=new Date(_0x3c5b6b(0xb7));let role='',ptosHot,baseHot,processing=![],generatedData=[],port,writer,isArduinoConnected=![];const baseData=[[_0x3c5b6b(0x11b),'IMEI','ID','IMEI\x20LENG',_0x3c5b6b(0x8d),'','',''],[0x3f8,0x310f561214fda,'003535',0xf,0x6,'','',''],[0x3f9,0x310f56121cd68,'003438',0xf,0x6,'','',''],[0x3fa,0x310f56132c02a,_0x3c5b6b(0xa9),0xf,0x6,'',-0x13b119657b556,-0x212c6df629597],[0x3fb,0x310f56132c520,'003332',0xf,0x6,'','',''],[0x40e,0x310f5615951fe,'004680',0xf,0x6,'','',''],[0x3fd,0x310f56121249a,_0x3c5b6b(0xcf),0xf,0x6,'','',''],[0x3fe,0x310f561217885,'003615',0xf,0x6,'','',''],[0x3ff,0x310f561660d76,_0x3c5b6b(0xe9),0xf,0x6,'','',''],[0x400,0x310f56121de6c,_0x3c5b6b(0x119),0xf,0x6,'','',''],[0x401,0x310f5615966e3,_0x3c5b6b(0xb3),0xf,0x6,'','',''],[0x402,0x310f5615dccc7,'005661',0xf,0x6,'','',''],[0x403,0x310f561211f0f,_0x3c5b6b(0x112),0xf,0x6,'','',''],[0x404,0x310f56167340a,'005666',0xf,0x6,'','',''],[0x405,0x310f56121d73d,'004639',0xf,0x6,'','',''],[0x406,0x310f561332c49,'005069',0xf,0x6,'','',''],[0x407,0x310f561594953,'005882',0xf,0x6,'','',''],[0x408,0x310f5612efb5d,_0x3c5b6b(0x85),0xf,0x6,'','',''],[0x410,0x310f561596c75,_0x3c5b6b(0x98),0xf,0x6,'','',''],[0x411,0x310f56121e569,_0x3c5b6b(0xd3),0xf,0x6,'','',''],[0x412,0x310f5615dce11,'006376',0xf,0x6,0x310f56166a73f,'',''],[0x413,0x310f56121bf5a,_0x3c5b6b(0xf0),0xf,0x6,'','',''],[0x414,0x310f561216649,_0x3c5b6b(0xbd),0xf,0x6,'','',''],[0x415,0x310f56121dc5d,_0x3c5b6b(0xfa),0xf,0x6,'','',''],[0x416,0x311a7438f034b,_0x3c5b6b(0xeb),0xf,0x6,'','',''],[0x417,0x310f56121cdcb,_0x3c5b6b(0x110),0xf,0x6,0x3121fa481d502,0x310f56121ceca,''],[0x418,0x310f561596fef,_0x3c5b6b(0xc0),0xf,0x6,'','',''],[0x419,0x310f561213a5a,_0x3c5b6b(0x11d),0xf,0x6,'','',''],[0x5dd,0x310f561216826,_0x3c5b6b(0xd7),0xf,0x6,'','',''],[0x41a,0x310f561216f8e,'104848',0xf,0x6,'','',''],[0x41b,0x310f56121b43d,'104837',0xf,0x6,'','',''],[0x41c,0x310f56132fd87,'122183',0xf,0x6,'','',''],[0x644,0x310f56172f10b,_0x3c5b6b(0x113),0xf,0x6,'','',''],[0x645,0x310f5613352a9,'003609',0xf,0x6,'','',''],[0x646,0x310f561595041,_0x3c5b6b(0x80),0xf,0x6,'','',''],[0x647,0x310f56121d6c0,_0x3c5b6b(0x9c),0xf,0x6,'','',''],[0x648,0x311a7438f18fc,'003266',0xf,0x6,'','',''],[0x5dd,0x310f561662190,_0x3c5b6b(0xd7),0xf,0x6,'','',''],[0x409,0x310f561661909,_0x3c5b6b(0x12b),0xf,0x6,'','',''],[0x40a,0x310f5615855cd,_0x3c5b6b(0xe4),0xf,0x6,'','',''],[0x41e,0x310f56158e902,'104929',0xf,0x6,'','',''],[0x41d,0x311a743919244,'104965',0xf,0x6,'','',''],[0x40f,0x310f5613328ff,_0x3c5b6b(0x125),0xf,0x6,'','',''],[0x40d,0x3121fa481d502,_0x3c5b6b(0x110),0xf,0x6,'','','']];function _0x12e6(){const _0x3cb99d=['block','hours','Conectado','value','105013','date','preventDefault','trim','createElement','requestPort','104906','admin-tab','length','üî¥\x20Desconectado','finHora','8HcHIiM','POST','Tag','getData','setDataAtCell','abs','üì§\x20Enviar\x20a\x20Arduino','DOMContentLoaded','submitRoute','üü¢\x20Enviando...','1306596NZGiHT','background','‚úÖ\x20Procesado:\x20','serialStatusDot','setItem','all','output','none','processed','username','setDate','Error:','split','non-commercial-and-evaluation','danger','1350369hJKdxl','inicioHora','007157','add','fin','http://127.0.0.1:5000/enviar','‚ö†Ô∏è\x20Sin\x20internet:\x20No\x20se\x20puede\x20validar\x20licencia.','005073','slice','üë§\x20Cliente\x20Aesa','374315LSLXQw','loadingOverlay','innerHTML','parse','‚ùå\x20Error\x20Agente:\x20','ID\x20LENG','no-store','scrollHeight','toString','datetime','No\x20se\x20generaron\x20datos.','‚úÖ\x20Listo','headers','Aesa','remove','.btn-process','013520','disabled','body','24kcMGGg','005677','‚ùå\x20Error\x20USB:\x20','unidad','https://worldtimeapi.org/api/timezone/America/Argentina/Buenos_Aires','agentStatus','\x20registros','diff','‚ùå\x20Credenciales\x20incorrectas','1101530fsUXzZ','getDate','Mobiliario\x20urbano','>RUS03,','\x20l√≠neas\x20enviadas.','003519','admin','üî¥\x20Error','üîå\x20Arduino\x20conectado\x20correctamente','loading-overlay\x20position-fixed\x20top-0\x20start-0\x20w-100\x20h-100\x20d-flex\x20align-items-center\x20justify-content-center','.btn-login','toISOString','Total','Rutas','color','005665','‚è≥\x20Enviando...','Servicios','href','2026-03-23','push','getItem','className','btnSendAgent','http://127.0.0.1:5000/status','001195','render','padEnd','103696','‚úÖ\x20Env√≠o\x20a\x20Arduino\x20completado','innerText','‚ö†Ô∏è\x20Navegador\x20no\x20compatible\x20con\x20USB\x20Serial.\x20Use\x20Chrome.','style','success','‚úÖ\x20Agente:\x20','‚õî\x20LICENCIA\x20VENCIDA\x20(Verificaci√≥n\x20Online).','forEach','green','#N/A','info','open','scrollTop','pipeTo','003675','<div\x20class=\x22bg-white\x20p-4\x20rounded-3\x20text-center\x20shadow\x22><div\x20class=\x22spinner-border\x20text-primary\x20mb-3\x22></div><p\x20class=\x22mb-0\x20fw-bold\x22>','div','main-content','013521','ptos-table','querySelector','fechaInicio','003268','\x20alert-custom\x20shadow-sm','HEAD','baseData','btnSendArduino','appendChild','routeModal','#ef4444','Direcci√≥n',',001;ID=','Verificando\x20fecha...','stringify','indexOf','007838','Salvadores','üíæ\x20Guardado','üë§\x20Admin','getWriter','005065','hide','050089','error','password','write','clone','015377','textContent','31850451WBwvxT',',0000000','get','display','Punto\x20de\x20recolecci√≥n','DDMMYYHHmmss','random',';#IP1:000C;*07<','011816','floor','Completa\x20todos\x20los\x20campos','#10b981','application/json','find','Pendientes','userBadge','message','6701716PIhvAa','Cumplimiento','click','Inicio','writable','‚öôÔ∏è\x20Configurar\x20Ruta\x20','reset','Promedio','<div\x20style=\x22color:#3b82f6;\x20font-size:0.8em\x22>üîå\x20USB:\x20Enviando\x20','warning','873520ZJWoJm','fechaFin','routeForm','050384','readable','005664','004321','Unidad','Sin\x20datos\x20para\x20procesar','getElementById','login-form','addEventListener','004646','‚ùå\x20Error\x20conectando\x20Arduino:\x20','Unidades','No\x20se\x20encontraron\x20rutas\x20en\x20la\x20columna\x20\x22Rutas\x22','104794','üîç\x20Buscando\x20.exe...','Tipo','</p></div>'];_0x12e6=function(){return _0x3cb99d;};return _0x12e6();}!localStorage[_0x3c5b6b(0xb9)](_0x3c5b6b(0xda))&&localStorage[_0x3c5b6b(0x13e)](_0x3c5b6b(0xda),JSON['stringify'](baseData));async function connectArduino(){const _0x5d19f4=_0x3c5b6b;if('serial'in navigator)try{port=await navigator['serial'][_0x5d19f4(0x12a)](),await port[_0x5d19f4(0xcc)]({'baudRate':0x2580});const _0xbede78=new TextEncoderStream(),_0x248087=_0xbede78[_0x5d19f4(0x111)][_0x5d19f4(0xce)](port['writable']);writer=_0xbede78[_0x5d19f4(0x107)][_0x5d19f4(0xe8)](),isArduinoConnected=!![],updateArduinoUI(!![]),showAlert(_0x5d19f4(0xac),_0x5d19f4(0xc5));}catch(_0x4c9340){console[_0x5d19f4(0xec)](_0x5d19f4(0x145),_0x4c9340),showAlert(_0x5d19f4(0x11a)+_0x4c9340[_0x5d19f4(0x102)],_0x5d19f4(0x7d));}else showAlert(_0x5d19f4(0xc3),_0x5d19f4(0x10c));}function updateArduinoUI(_0x335c82){const _0x3a7180=_0x3c5b6b,_0x22b754=document['getElementById'](_0x3a7180(0x13d)),_0x44c13a=document['getElementById']('serialStatusText'),_0x1776e0=document[_0x3a7180(0x116)](_0x3a7180(0xdb));if(_0x335c82){_0x22b754['style'][_0x3a7180(0x13b)]='#10b981',_0x44c13a[_0x3a7180(0xf1)]=_0x3a7180(0x123),_0x44c13a[_0x3a7180(0xc4)][_0x3a7180(0xb2)]=_0x3a7180(0xfd);if(generatedData[_0x3a7180(0x12d)]>0x0)_0x1776e0[_0x3a7180(0x99)]=![];}else _0x22b754[_0x3a7180(0xc4)][_0x3a7180(0x13b)]=_0x3a7180(0xde),_0x44c13a[_0x3a7180(0xf1)]='Desconectado',_0x1776e0[_0x3a7180(0x99)]=!![];}async function sendToArduino(){const _0xef5857=_0x3c5b6b;if(!isArduinoConnected||!writer)return showAlert('Conecta\x20el\x20Arduino\x20primero','warning');const _0x443698=document[_0xef5857(0x116)](_0xef5857(0xdb));_0x443698[_0xef5857(0x99)]=!![],_0x443698[_0xef5857(0x8a)]='Enviando...';try{for(let _0xdf2a4f=0x0;_0xdf2a4f<generatedData['length'];_0xdf2a4f++){const _0x44b118=generatedData[_0xdf2a4f];if(_0x44b118['trim']()){await writer[_0xef5857(0xee)](_0x44b118+'\x0a'),document[_0xef5857(0x116)](_0xef5857(0x140))['innerHTML']+=_0xef5857(0x10b)+(_0xdf2a4f+0x1)+'/'+generatedData['length']+'...</div>';const _0x16c7f3=document[_0xef5857(0x116)](_0xef5857(0x140));_0x16c7f3[_0xef5857(0xcd)]=_0x16c7f3[_0xef5857(0x8f)],await new Promise(_0x18cb10=>setTimeout(_0x18cb10,0x3e8));}}showAlert(_0xef5857(0xc1),_0xef5857(0xc5));}catch(_0x2e88a6){showAlert(_0xef5857(0x9d)+_0x2e88a6[_0xef5857(0x102)],_0xef5857(0x7d));}finally{_0x443698['disabled']=![],_0x443698[_0xef5857(0x8a)]=_0xef5857(0x136);}}async function sendToLocalAgent(){const _0x21f1b0=_0x3c5b6b;if(generatedData[_0x21f1b0(0x12d)]===0x0)return showAlert('No\x20hay\x20datos\x20para\x20enviar',_0x21f1b0(0x10c));const _0x52c693=document[_0x21f1b0(0x116)]('btnSendAgent'),_0xaf4fc6=document[_0x21f1b0(0x116)](_0x21f1b0(0xa0));_0xaf4fc6[_0x21f1b0(0xf1)]=_0x21f1b0(0x11e);try{await fetch(_0x21f1b0(0xbc));}catch(_0x116c17){showAlert('‚ùå\x20No\x20se\x20encuentra\x20el\x20Agente\x20(.exe).\x20Ejec√∫talo\x20primero.','danger'),_0xaf4fc6[_0x21f1b0(0xf1)]=_0x21f1b0(0x12e);return;}_0x52c693[_0x21f1b0(0x99)]=!![],_0x52c693[_0x21f1b0(0x8a)]=_0x21f1b0(0xb4),_0xaf4fc6[_0x21f1b0(0xf1)]=_0x21f1b0(0x139),_0xaf4fc6[_0x21f1b0(0xc4)][_0x21f1b0(0xb2)]=_0x21f1b0(0xc9);try{const _0x190dde=await fetch(_0x21f1b0(0x83),{'method':_0x21f1b0(0x131),'headers':{'Content-Type':_0x21f1b0(0xfe)},'body':JSON[_0x21f1b0(0xe2)]({'lines':generatedData})}),_0x25e826=await _0x190dde['json']();if(_0x190dde['ok'])showAlert(_0x21f1b0(0xc6)+_0x25e826[_0x21f1b0(0x142)]+_0x21f1b0(0xa8),'success'),_0xaf4fc6[_0x21f1b0(0xf1)]=_0x21f1b0(0x93);else throw new Error(_0x25e826[_0x21f1b0(0xec)]);}catch(_0x237bcb){showAlert(_0x21f1b0(0x8c)+_0x237bcb['message'],'danger'),_0xaf4fc6[_0x21f1b0(0xf1)]=_0x21f1b0(0xab),_0xaf4fc6[_0x21f1b0(0xc4)][_0x21f1b0(0xb2)]='red';}finally{_0x52c693[_0x21f1b0(0x99)]=![],_0x52c693[_0x21f1b0(0x8a)]='üì°\x20Enviar\x20v√≠a\x20Script';}}async function obtenerFechaInternet(){const _0x4ee81e=_0x3c5b6b;try{const _0x2118c2=await fetch(window['location'][_0x4ee81e(0xb6)],{'method':_0x4ee81e(0xd9),'cache':_0x4ee81e(0x8e)}),_0x313f29=_0x2118c2[_0x4ee81e(0x94)][_0x4ee81e(0xf4)](_0x4ee81e(0x126));if(!_0x313f29){const _0x41ab96=await fetch(_0x4ee81e(0x9f));return new Date((await _0x41ab96['json']())[_0x4ee81e(0x91)]);}return new Date(_0x313f29);}catch(_0x175848){return null;}}async function login(_0x3bd560){const _0x4b637e=_0x3c5b6b;_0x3bd560[_0x4b637e(0x127)]();const _0x5045bb=document[_0x4b637e(0xd5)](_0x4b637e(0xae)),_0x1bb22d=_0x5045bb[_0x4b637e(0x8a)];_0x5045bb[_0x4b637e(0x99)]=!![],_0x5045bb[_0x4b637e(0x8a)]=_0x4b637e(0xe1);const _0x439376=document['getElementById'](_0x4b637e(0x143))[_0x4b637e(0x124)][_0x4b637e(0x128)](),_0x1ce787=document[_0x4b637e(0x116)](_0x4b637e(0xed))[_0x4b637e(0x124)],_0xfc4aa0=await obtenerFechaInternet();if(!_0xfc4aa0){showAlert(_0x4b637e(0x84),_0x4b637e(0x10c)),_0x5045bb[_0x4b637e(0x99)]=![],_0x5045bb[_0x4b637e(0x8a)]=_0x1bb22d;return;}if(_0x439376===_0x4b637e(0xaa)&&_0x1ce787==='adminpass')role=_0x4b637e(0xaa),startApp(_0x4b637e(0xe7));else{if(_0x439376===_0x4b637e(0x95)&&_0x1ce787===_0x4b637e(0xe5)){if(_0xfc4aa0>FECHA_VENCIMIENTO_WEB){showAlert(_0x4b637e(0xc7),_0x4b637e(0x7d)),_0x5045bb['disabled']=![],_0x5045bb['innerHTML']=_0x1bb22d;return;}role='normal',startApp(_0x4b637e(0x87));}else showAlert(_0x4b637e(0xa3),_0x4b637e(0x7d)),_0x5045bb[_0x4b637e(0x99)]=![],_0x5045bb[_0x4b637e(0x8a)]=_0x1bb22d;}}function startApp(_0x16a929){const _0x14efe4=_0x3c5b6b;document[_0x14efe4(0x116)](_0x14efe4(0x117))[_0x14efe4(0xc4)][_0x14efe4(0xf5)]=_0x14efe4(0x141),document[_0x14efe4(0x116)](_0x14efe4(0xd2))[_0x14efe4(0xc4)]['display']=_0x14efe4(0x121),document[_0x14efe4(0x116)](_0x14efe4(0x101))['innerHTML']=_0x16a929;if(role===_0x14efe4(0xaa))document[_0x14efe4(0x116)](_0x14efe4(0x12c))[_0x14efe4(0xc4)]['display']='block';initTables();}async function processData(){const _0x260533=_0x3c5b6b;if(processing)return;processing=!![],document[_0x260533(0xd5)](_0x260533(0x97))['disabled']=!![],showLoading('Procesando...'),generatedData=[];try{const _0x39cfab=ptosHot['getData'](),_0x478fa1=_0x39cfab['slice'](0x1)['filter'](_0x28ab09=>_0x28ab09[0x0]&&_0x28ab09[0x0][_0x260533(0x90)]()['trim']()!=='');if(_0x478fa1[_0x260533(0x12d)]===0x0)throw new Error(_0x260533(0x115));const _0x2247f5=new Set();_0x478fa1[_0x260533(0xc8)](_0x1f49df=>{const _0x20d46f=_0x260533;if(_0x1f49df[0x5])_0x1f49df[0x5][_0x20d46f(0x90)]()['split'](',')[_0x20d46f(0xc8)](_0x1ef6f9=>{const _0x27b2bd=_0x20d46f;if(_0x1ef6f9[_0x27b2bd(0x128)]())_0x2247f5[_0x27b2bd(0x81)](_0x1ef6f9['trim']());});});const _0x2ac72a=[..._0x2247f5];if(_0x2ac72a[_0x260533(0x12d)]===0x0)throw new Error(_0x260533(0x11c));const _0x5f5795={},_0x5598ad=new bootstrap['Modal'](document['getElementById'](_0x260533(0xdd)));hideLoading();for(const _0x4399ae of _0x2ac72a){document[_0x260533(0x116)]('routeModalLabel')[_0x260533(0xc2)]=_0x260533(0x108)+_0x4399ae;const _0xc971ed=document['getElementById'](_0x260533(0x10f));_0xc971ed[_0x260533(0x109)](),document['getElementById'](_0x260533(0xd6))['value']=new Date(Date['now']()-0x5265c00)[_0x260533(0xaf)]()[_0x260533(0x7b)]('T')[0x0],document['getElementById'](_0x260533(0x10e))['value']=new Date()['toISOString']()[_0x260533(0x7b)]('T')[0x0];const _0xd4cb07=await new Promise(_0x56e524=>{const _0x511e81=_0x260533,_0x572a2a=()=>{const _0xfc5f0b=_0x3860,_0x469b8b=document[_0xfc5f0b(0x116)](_0xfc5f0b(0x9e))[_0xfc5f0b(0x124)],_0x25a7f7=document[_0xfc5f0b(0x116)](_0xfc5f0b(0xd6))[_0xfc5f0b(0x124)],_0x562cc3=document[_0xfc5f0b(0x116)](_0xfc5f0b(0x10e))['value'],_0x53aba9=document['getElementById'](_0xfc5f0b(0x7f))[_0xfc5f0b(0x124)],_0x15764f=document[_0xfc5f0b(0x116)](_0xfc5f0b(0x12f))[_0xfc5f0b(0x124)];if(_0x469b8b&&_0x25a7f7&&_0x562cc3&&_0x53aba9&&_0x15764f)_0x5598ad[_0xfc5f0b(0xea)](),document[_0xfc5f0b(0x116)](_0xfc5f0b(0x138))['removeEventListener'](_0xfc5f0b(0x105),_0x572a2a),_0x56e524({'unidad':_0x469b8b,'inicio':_0x25a7f7+'\x20'+_0x53aba9,'fin':_0x562cc3+'\x20'+_0x15764f});else alert(_0xfc5f0b(0xfc));};document[_0x511e81(0x116)](_0x511e81(0x138))[_0x511e81(0x118)](_0x511e81(0x105),_0x572a2a),_0x5598ad['show']();});_0x5f5795[_0x4399ae]=_0xd4cb07;}showLoading('Generando...');let _0x304361='';_0x478fa1[_0x260533(0xc8)]((_0x363d8a,_0x5564c1)=>{const _0x2d723c=_0x260533,_0x183da2=_0x39cfab[_0x2d723c(0xe3)](_0x363d8a),_0x40ce38=_0x363d8a[0x5]?_0x363d8a[0x5]['toString']()[_0x2d723c(0x7b)](',')['map'](_0x51b028=>_0x51b028[_0x2d723c(0x128)]()):[];let _0x550378=null;for(const _0x5b5276 of _0x40ce38)if(_0x5f5795[_0x5b5276]){_0x550378=_0x5f5795[_0x5b5276];break;}if(!_0x550378||!_0x363d8a[0xc]||!_0x363d8a[0xd])return;ptosHot['setDataAtCell'](_0x183da2,0xe,_0x550378[_0x2d723c(0x9e)]),ptosHot['setDataAtCell'](_0x183da2,0xf,_0x550378['inicio']),ptosHot[_0x2d723c(0x134)](_0x183da2,0x10,_0x550378[_0x2d723c(0x82)]);const _0x47ab44=parseFloat(_0x363d8a[0xc]),_0x340ac6=parseFloat(_0x363d8a[0xd]),_0x13dc7a=(_0x47ab44<0x0?'-':'')+Math[_0x2d723c(0x135)](_0x47ab44)[_0x2d723c(0x90)]()['replace']('.','')[_0x2d723c(0xbf)](0xf,'0')['slice'](0x0,0x7),_0xa5dc86=(_0x340ac6<0x0?'-':'')+Math[_0x2d723c(0x135)](_0x340ac6)[_0x2d723c(0x90)]()['replace']('.','')[_0x2d723c(0xbf)](0xf,'0')[_0x2d723c(0x86)](0x0,0x6);ptosHot['setDataAtCell'](_0x183da2,0xc,_0x13dc7a),ptosHot[_0x2d723c(0x134)](_0x183da2,0xd,_0xa5dc86);const _0x3e0c2b=moment(_0x550378['inicio']),_0x26c0cf=moment(_0x550378['fin']),_0x30a612=Math[_0x2d723c(0xfb)](Math[_0x2d723c(0xf8)]()*_0x26c0cf[_0x2d723c(0xa2)](_0x3e0c2b,'minutes')),_0x51a3ad=_0x3e0c2b[_0x2d723c(0xef)]()[_0x2d723c(0x81)](_0x30a612,'minutes')['add'](0x3,_0x2d723c(0x122)),_0x71bbb7=JSON[_0x2d723c(0x8b)](localStorage[_0x2d723c(0xb9)](_0x2d723c(0xda))),_0x10fc07=_0x71bbb7[_0x2d723c(0xff)](_0x3621e7=>_0x3621e7[0x0]==_0x550378[_0x2d723c(0x9e)]),_0x2c16e9=_0x10fc07?_0x10fc07[0x1]:_0x2d723c(0xca),_0x3abc13=_0x10fc07?_0x10fc07[0x2]:_0x2d723c(0xca),_0x2d2737=_0x2d723c(0xa7)+_0x51a3ad['format'](_0x2d723c(0xf7))+_0x13dc7a+_0xa5dc86+'2929900000734261011,'+_0x2c16e9+_0x2d723c(0xf3)+(_0x363d8a[0x4]||'0')+_0x2d723c(0xe0)+_0x3abc13+_0x2d723c(0xf9);generatedData[_0x2d723c(0xb8)](_0x2d2737),_0x304361+=_0x2d2737+'\x0a';}),ptosHot[_0x260533(0xbe)](),document[_0x260533(0x116)](_0x260533(0x140))[_0x260533(0xc2)]=_0x304361||_0x260533(0x92);if(generatedData[_0x260533(0x12d)]>0x0){document[_0x260533(0x116)](_0x260533(0xbb))['disabled']=![];if(isArduinoConnected)document['getElementById']('btnSendArduino')[_0x260533(0x99)]=![];}showAlert(_0x260533(0x13c)+generatedData['length']+_0x260533(0xa1),_0x260533(0xc5));}catch(_0xc5b6cd){showAlert('‚ùå\x20'+_0xc5b6cd[_0x260533(0x102)],_0x260533(0x7d));}finally{processing=![],document[_0x260533(0xd5)](_0x260533(0x97))[_0x260533(0x99)]=![],hideLoading();}}function initTables(){const _0x3f4314=_0x3c5b6b;ptosHot=new Handsontable(document['getElementById'](_0x3f4314(0xd4)),{'data':[[_0x3f4314(0xdf),_0x3f4314(0xf6),_0x3f4314(0xa6),_0x3f4314(0x11f),_0x3f4314(0x132),_0x3f4314(0xb1),_0x3f4314(0xb0),_0x3f4314(0x100),_0x3f4314(0x10a),_0x3f4314(0xb5),'No\x20Op',_0x3f4314(0x104),'Latitud','Longitud',_0x3f4314(0x114),_0x3f4314(0x106),'Fin']],'rowHeaders':!![],'colHeaders':!![],'height':0x258,'licenseKey':'non-commercial-and-evaluation','minRows':0x32,'minCols':0x11,'contextMenu':!![],'manualColumnResize':!![],'stretchH':_0x3f4314(0x13f)});if(role===_0x3f4314(0xaa)){const _0x342ca4=JSON['parse'](localStorage[_0x3f4314(0xb9)](_0x3f4314(0xda)));baseHot=new Handsontable(document[_0x3f4314(0x116)]('base-table'),{'data':_0x342ca4||baseData,'rowHeaders':!![],'colHeaders':!![],'height':0x258,'licenseKey':_0x3f4314(0x7c),'minRows':0x32,'minCols':0x9,'contextMenu':!![],'manualColumnResize':!![],'stretchH':_0x3f4314(0x13f)});}}function saveBase(){const _0x5c716c=_0x3c5b6b;if(role!=='admin')return;localStorage[_0x5c716c(0x13e)](_0x5c716c(0xda),JSON[_0x5c716c(0xe2)](baseHot[_0x5c716c(0x133)]())),showAlert(_0x5c716c(0xe6),_0x5c716c(0xc5));}function showAlert(_0x314998,_0x3a2f00=_0x3c5b6b(0xcb)){const _0x289b37=_0x3c5b6b,_0x45bcff=document['createElement'](_0x289b37(0xd1));_0x45bcff[_0x289b37(0xba)]='alert\x20alert-'+_0x3a2f00+_0x289b37(0xd8),_0x45bcff[_0x289b37(0x8a)]=_0x314998,document['body'][_0x289b37(0xdc)](_0x45bcff),setTimeout(()=>_0x45bcff[_0x289b37(0x96)](),0xfa0);}function showLoading(_0xacf4de){const _0x579e22=_0x3c5b6b,_0x4ed227=document[_0x579e22(0x129)](_0x579e22(0xd1));_0x4ed227['className']=_0x579e22(0xad),_0x4ed227['id']=_0x579e22(0x89),_0x4ed227['style']['zIndex']='9999',_0x4ed227['innerHTML']=_0x579e22(0xd0)+_0xacf4de+_0x579e22(0x120),document[_0x579e22(0x9a)]['appendChild'](_0x4ed227);}function hideLoading(){const _0x49fb08=_0x3c5b6b,_0x17e78c=document[_0x49fb08(0x116)](_0x49fb08(0x89));if(_0x17e78c)_0x17e78c[_0x49fb08(0x96)]();}document[_0x3c5b6b(0x118)](_0x3c5b6b(0x137),()=>{const _0x412511=_0x3c5b6b,_0x436ed2=new Date(),_0x1f5403=new Date(_0x436ed2);_0x1f5403[_0x412511(0x144)](_0x1f5403[_0x412511(0xa5)]()-0x1);const _0x316bc5=document[_0x412511(0x116)]('fechaInicio'),_0x258f1e=document['getElementById'](_0x412511(0x10e));_0x316bc5&&_0x258f1e&&(_0x316bc5[_0x412511(0x124)]=_0x1f5403[_0x412511(0xaf)]()[_0x412511(0x7b)]('T')[0x0],_0x258f1e[_0x412511(0x124)]=_0x436ed2[_0x412511(0xaf)]()[_0x412511(0x7b)]('T')[0x0]);});
    </script>
</body>

</html>



